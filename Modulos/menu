#!/bin/bash

#=============================================================================
# SSHPlus Manager - Ana Menü (Türkçe)
# Geliştirici: @requmen
# Tarih: 2025-12-05
# Versiyon: v39
# Açıklama: SSH ve VPN yönetim aracı ana menüsü
#=============================================================================

# Renkler
RED='\033[1;31m'
GREEN='\033[1;32m'
YELLOW='\033[1;33m'
BLUE='\033[1;34m'
CYAN='\033[1;36m'
WHITE='\033[1;37m'
RESET='\033[0m'

# İlerleme çubuğu fonksiyonu
fun_bar() {
    comando[0]="$1"
    comando[1]="$2"
    (
        [[ -e $HOME/fim ]] && rm $HOME/fim
        [[ ! -e /usr/lib/sshplus ]] && rm -rf /bin/menu > /dev/null 2>&1
        ${comando[0]} -y > /dev/null 2>&1
        ${comando[1]} -y > /dev/null 2>&1
        touch $HOME/fim
    ) > /dev/null 2>&1 &
    
    tput civis
    echo -ne "${YELLOW}["
    while true; do
        for((i=0; i<18; i++)); do
            echo -ne "${RED}#"
            sleep 0.1s
        done
        [[ -e $HOME/fim ]] && rm $HOME/fim && break
        echo -e "${YELLOW}]"
        sleep 1s
        tput cuu1
        tput dl1
        echo -ne "${YELLOW}["
    done
    echo -e "${YELLOW}]${WHITE} -${GREEN} TAMAM!${WHITE}"
    tput cnorm
}

# IP adresini al
IP=$(cat /etc/IP 2>/dev/null || echo "Bilinmiyor")

# Ana menü fonksiyonu
menu() {
    # Hız testi fonksiyonu
    velocity() {
        aguarde() {
            comando[0]="$1"
            comando[1]="$2"
            (
                [[ -e $HOME/fim ]] && rm $HOME/fim
                [[ ! -d /etc/SSHPlus ]] && rm -rf /bin/menu
                ${comando[0]} > /dev/null 2>&1
                ${comando[1]} > /dev/null 2>&1
                touch $HOME/fim
            ) > /dev/null 2>&1 &
            
            tput civis
            echo -ne "  ${YELLOW}LÜTFEN BEKLEYİN ${WHITE}- ${YELLOW}["
            while true; do
                for((i=0; i<18; i++)); do
                    echo -ne "${RED}#"
                    sleep 0.1s
                done
                [[ -e $HOME/fim ]] && rm $HOME/fim && break
                echo -e "${YELLOW}]"
                sleep 1s
                tput cuu1
                tput dl1
                echo -ne "  ${YELLOW}LÜTFEN BEKLEYİN ${WHITE}- ${YELLOW}["
            done
            echo -e "${YELLOW}]${WHITE} -${GREEN} TAMAM!${WHITE}"
            tput cnorm
        }
        
        fun_tst() {
            speedtest --share > speed
        }
        
        echo ""
        echo -e "   ${GREEN}SUNUCU HIZI TEST EDİLİYOR!${RESET}"
        echo ""
        aguarde 'fun_tst'
        echo ""
        png=$(cat speed | sed -n '5 p' |awk -F : {'print $NF'})
        down=$(cat speed | sed -n '7 p' |awk -F :  {'print $NF'})
        upl=$(cat speed | sed -n '9 p' |awk -F :  {'print $NF'})
        lnk=$(cat speed | sed -n '10 p' |awk {'print $NF'})
        echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
        echo -e "${GREEN}PING (GECİKME):${WHITE}$png"
        echo -e "${GREEN}İNDİRME:${WHITE}$down"
        echo -e "${GREEN}YÜKLEME:${WHITE}$upl"
        echo -e "${GREEN}LİNK: ${CYAN}$lnk${RESET}"
        echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
        rm -rf $HOME/speed
    }
    
    # Limiter başlat
    limit1() {
        clear
        echo -e "\n${GREEN}LİMİTER BAŞLATILIYOR...${RESET}"
        echo ""
        fun_bar 'screen -dmS limiter limiter' 'sleep 3'
        [[ $(grep -wc "limiter" /etc/autostart) = '0' ]] && {
            echo -e "ps x | grep 'limiter' | grep -v 'grep' && echo 'ON' || screen -dmS limiter limiter" >> /etc/autostart
        } || {
            sed -i '/limiter/d' /etc/autostart
            echo -e "ps x | grep 'limiter' | grep -v 'grep' && echo 'ON' || screen -dmS limiter limiter" >> /etc/autostart
        }
        echo -e "\n${GREEN}  LİMİTER AKTİF!${RESET}"
        sleep 3
        menu
    }
    
    # Limiter durdur
    limit2() {
        clear
        echo -e "${GREEN}LİMİTER DURDURULUYOR...${RESET}"
        echo ""
        fun_bar 'killall limiter' 'sleep 3'
        sed -i '/limiter/d' /etc/autostart
        echo -e "\n${GREEN}  LİMİTER DURDURULDU!${RESET}"
        sleep 3
        menu
    }
    
    # BadVPN başlat
    badvpn1() {
        clear
        echo -e "\n${GREEN}BADVPN BAŞLATILIYOR...${RESET}"
        echo ""
        fun_bar 'screen -dmS udpvpn udpvpn' 'sleep 3'
        [[ $(grep -wc "udpvpn" /etc/autostart) = '0' ]] && {
            echo -e "ps x | grep 'udpvpn' | grep -v 'grep' && echo 'ON' || screen -dmS udpvpn udpvpn" >> /etc/autostart
        } || {
            sed -i '/udpvpn/d' /etc/autostart
            echo -e "ps x | grep 'udpvpn' | grep -v 'grep' && echo 'ON' || screen -dmS udpvpn udpvpn" >> /etc/autostart
        }
        echo -e "\n${GREEN}  BADVPN AKTİF!${RESET}"
        sleep 3
        menu
    }
    
    # BadVPN durdur
    badvpn2() {
        clear
        echo -e "${GREEN}BADVPN DURDURULUYOR...${RESET}"
        echo ""
        fun_bar 'killall udpvpn' 'sleep 3'
        sed -i '/udpvpn/d' /etc/autostart
        echo -e "\n${GREEN}  BADVPN DURDURULDU!${RESET}"
        sleep 3
        menu
    }
    
    # İkinci menü (Daha fazla seçenekler)
    menu2() {
        clear
        echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
        echo -e "\E[41;1;37m            ⇱ SSHPlus Manager by @requmen - DAHA FAZLA ⇲         \E[0m"
        echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
        echo ""
        echo -e "${RED}[${CYAN}20${RED}] ${WHITE}• ${YELLOW}HOST EKLE${RED}                   [${CYAN}26${RED}] ${WHITE}• ${YELLOW}ROOT ŞİFRESİ${RED}"
        echo -e "${RED}[${CYAN}21${RED}] ${WHITE}• ${YELLOW}HOST SİL${RED}                    [${CYAN}27${RED}] ${WHITE}• ${YELLOW}OTO BAŞLATMA${RED}"
        echo -e "${RED}[${CYAN}22${RED}] ${WHITE}• ${YELLOW}SİSTEMİ YENİDEN BAŞLAT${RED}      [${CYAN}28${RED}] ${WHITE}• ${YELLOW}SCRİPT GÜNCELLE${RED}"
        echo -e "${RED}[${CYAN}23${RED}] ${WHITE}• ${YELLOW}SERVİSLERİ YENİDEN BAŞLAT${RED}   [${CYAN}29${RED}] ${WHITE}• ${YELLOW}SCRİPT SİL${RED}"
        echo -e "${RED}[${CYAN}24${RED}] ${WHITE}• ${YELLOW}TORRENT ENGELLE${RED}             [${CYAN}30${RED}] ${WHITE}• ${YELLOW}ANA MENÜ ${GREEN}<${YELLOW}<${RED}<${RED}"
        echo -e "${RED}[${CYAN}25${RED}] ${WHITE}• ${YELLOW}TELEGRAM BOT${RED}                [${CYAN}00${RED}] ${WHITE}• ${YELLOW}ÇIKIŞ ${GREEN}<${YELLOW}<${RED}<${RED}"
        echo ""
        echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
        echo ""
        echo -ne "${GREEN}NE YAPMAK İSTERSİNİZ ${YELLOW}?${RED}?${WHITE} : "; read x
        
        case "$x" in
            20)
                clear
                addhost
                echo -ne "\n${RED}ENTER tuşuna basarak ${YELLOW}tuşuna basarak ${GREEN}MENÜYE${RESET} dönün!"; read
                menu2
                ;;
            21)
                clear
                delhost
                echo -ne "\n${RED}ENTER tuşuna basarak ${YELLOW}tuşuna basarak ${GREEN}MENÜYE${RESET} dönün!"; read
                menu2
                ;;
            22)
                clear
                reiniciarsistema
                ;;
            23)
                clear
                reiniciarservicos
                sleep 3
                ;;
            24)
                blockt
                ;;
            25)
                botssh
                ;;
            26)
                clear
                senharoot
                sleep 3
                ;;
            27)
                autoexec
                ;;
            28)
                attscript
                ;;
            29)
                clear
                delscript
                exit
                ;;
            30)
                menu
                ;;
            0|00)
                echo -e "${RED}Çıkılıyor...${RESET}"
                sleep 2
                clear
                exit
                ;;
            *)
                echo -e "\n${RED}Geçersiz seçenek!${RESET}"
                sleep 2
                ;;
        esac
    }
    
    # Ana döngü
    while true; do
        # Servis durumları
        stsl=$(ps x | grep "limiter"|grep -v grep > /dev/null && echo -e "${GREEN}◉ " || echo -e "${RED}○ ")
        stsu=$(ps x | grep "udpvpn"|grep -v grep > /dev/null && echo -e "${GREEN}◉ " || echo -e "${RED}○ ")
        
        # Sistem bilgileri
        if [[ "$(grep -c "Ubuntu" /etc/issue.net)" = "1" ]]; then
            system=$(cut -d' ' -f1 /etc/issue.net)
            system+=$(echo ' ')
            system+=$(cut -d' ' -f2 /etc/issue.net |awk -F "." '{print $1}')
        elif [[ "$(grep -c "Debian" /etc/issue.net)" = "1" ]]; then
            system=$(cut -d' ' -f1 /etc/issue.net)
            system+=$(echo ' ')
            system+=$(cut -d' ' -f3 /etc/issue.net)
        else
            system=$(cut -d' ' -f1 /etc/issue.net)
        fi
        
        # Kullanıcı istatistikleri
        _ons=$(ps -x | grep sshd | grep -v root | grep priv | wc -l)
        [[ "$(cat /etc/SSHPlus/Exp 2>/dev/null)" != "" ]] && _expuser=$(cat /etc/SSHPlus/Exp) || _expuser="0"
        [[ -e /etc/openvpn/openvpn-status.log ]] && _onop=$(grep -c "10.8.0" /etc/openvpn/openvpn-status.log) || _onop="0"
        [[ -e /etc/default/dropbear ]] && _drp=$(ps aux | grep dropbear | grep -v grep | wc -l) && _ondrp=$(($_drp - 1)) || _ondrp="0"
        _onli=$(($_ons + $_onop + $_ondrp))
        
        # Sistem kaynakları
        _ram=$(printf ' %-9s' "$(free -h | grep -i mem | awk {'print $2'})")
        _usor=$(printf '%-8s' "$(free -m | awk 'NR==2{printf "%.2f%%", $3*100/$2 }')")
        _usop=$(printf '%-1s' "$(top -bn1 | awk '/Cpu/ { cpu = "" 100 - $8 "%" }; END { print cpu }')")
        _core=$(printf '%-1s' "$(grep -c cpu[0-9] /proc/stat)")
        _system=$(printf '%-14s' "$system")
        _hora=$(printf '%(%H:%M:%S)T')
        _onlin=$(printf '%-5s' "$_onli")
        _userexp=$(printf '%-5s' "$_expuser")
        _tuser=$(awk -F: '$3>=1000 {print $1}' /etc/passwd | grep -v nobody | wc -l)
        
        # Menü gösterimi
        clear
        echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
        echo -e "\E[41;1;37m               ⇱ SSHPlus Manager by @requmen ⇲                \E[0m"
        echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
        echo -e "${GREEN}SİSTEM             BELLEK RAM       İŞLEMCİ "
        echo -e "${RED}OS: ${WHITE}$_system ${RED}Toplam:${WHITE}$_ram ${RED}Çekirdek: ${WHITE}$_core${RESET}"
        echo -e "${RED}Saat: ${WHITE}$_hora     ${RED}Kullanımda: ${WHITE}$_usor ${RED}Kullanımda: ${WHITE}$_usop${RESET}"
        echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
        echo -e "${GREEN}Çevrimiçi:${WHITE} $_onlin     ${RED}Süresi Dolmuş: ${WHITE}$_userexp ${YELLOW}Toplam: ${WHITE}$_tuser${RESET}"
        echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
        echo ""
        echo -e "${RED}[${CYAN}01${RED}] ${WHITE}• ${YELLOW}KULLANICI OLUŞTUR${RED}            [${CYAN}11${RED}] ${WHITE}• ${YELLOW}HIZ TESTİ${RED}"
        echo -e "${RED}[${CYAN}02${RED}] ${WHITE}• ${YELLOW}TEST KULLANICISI OLUŞTUR${RED}     [${CYAN}12${RED}] ${WHITE}• ${YELLOW}BANNER${RED}"
        echo -e "${RED}[${CYAN}03${RED}] ${WHITE}• ${YELLOW}KULLANICI SİL${RED}                [${CYAN}13${RED}] ${WHITE}• ${YELLOW}TRAFİK${RED}"
        echo -e "${RED}[${CYAN}04${RED}] ${WHITE}• ${YELLOW}ÇEVRİMİÇİ İZLEME${RED}             [${CYAN}14${RED}] ${WHITE}• ${YELLOW}OPTİMİZE ET${RED}"
        echo -e "${RED}[${CYAN}05${RED}] ${WHITE}• ${YELLOW}TARİH DEĞİŞTİR${RED}              [${CYAN}15${RED}] ${WHITE}• ${YELLOW}YEDEKLEME${RED}"
        echo -e "${RED}[${CYAN}06${RED}] ${WHITE}• ${YELLOW}LİMİT DEĞİŞTİR${RED}              [${CYAN}16${RED}] ${WHITE}• ${YELLOW}LİMİTER $stsl${RED}"
        echo -e "${RED}[${CYAN}07${RED}] ${WHITE}• ${YELLOW}ŞİFRE DEĞİŞTİR${RED}              [${CYAN}17${RED}] ${WHITE}• ${YELLOW}BAD VPN $stsu${RED}"
        echo -e "${RED}[${CYAN}08${RED}] ${WHITE}• ${YELLOW}SÜRESİ DOLMUŞLARI SİL${RED}        [${CYAN}18${RED}] ${WHITE}• ${YELLOW}VPS BİLGİSİ${RED}"
        echo -e "${RED}[${CYAN}09${RED}] ${WHITE}• ${YELLOW}KULLANICI RAPORU${RED}             [${CYAN}19${RED}] ${WHITE}• ${YELLOW}DAHA FAZLA ${RED}>${YELLOW}>${GREEN}>${RESET}${RED}"
        echo -e "${RED}[${CYAN}10${RED}] ${WHITE}• ${YELLOW}BAĞLANTI MODU${RED}                [${CYAN}00${RED}] ${WHITE}• ${YELLOW}ÇIKIŞ ${GREEN}<${YELLOW}<${RED}<${RESET}"
        echo ""
        echo -e "${BLUE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
        echo ""
        echo -e "${CYAN}Geliştirici: ${WHITE}@requmen ${CYAN}| Versiyon: ${WHITE}v39${RESET}"
        echo ""
        echo -ne "${GREEN}NE YAPMAK İSTERSİNİZ ${YELLOW}?${RED}?${WHITE} : "; read x
        
        case "$x" in 
            1|01)
                clear
                criarusuario
                echo -ne "\n${RED}ENTER tuşuna basarak ${YELLOW}tuşuna basarak ${GREEN}MENÜYE${RESET} dönün!"; read
                ;;
            2|02)
                clear
                criarteste
                echo -ne "\n${RED}ENTER tuşuna basarak ${YELLOW}tuşuna basarak ${GREEN}MENÜYE${RESET} dönün!"; read
                ;;
            3|03)
                clear
                remover
                sleep 3
                ;;
            4|04)
                clear
                sshmonitor
                echo -ne "\n${RED}ENTER tuşuna basarak ${YELLOW}tuşuna basarak ${GREEN}MENÜYE${RESET} dönün!"; read
                ;;      
            5|05)
                clear
                mudardata
                sleep 3
                ;;
            6|06)
                clear
                alterarlimite
                sleep 3
                ;; 
            7|07)
                clear
                alterarsenha
                sleep 3
                ;;
            8|08)
                clear
                expcleaner
                echo -ne "\n${RED}ENTER tuşuna basarak ${YELLOW}tuşuna basarak ${GREEN}MENÜYE${RESET} dönün!"; read
                ;;
            9|09)
                clear
                infousers
                echo -ne "\n${RED}ENTER tuşuna basarak ${YELLOW}tuşuna basarak ${GREEN}MENÜYE${RESET} dönün!"; read
                ;;
            10)
                clear
                conexao
                echo -ne "\n${RED}ENTER tuşuna basarak ${YELLOW}tuşuna basarak ${GREEN}MENÜYE${RESET} dönün!"; read
                ;;
            11)
                velocity
                echo -ne "\n${RED}ENTER tuşuna basarak ${YELLOW}tuşuna basarak ${GREEN}MENÜYE${RESET} dönün!"; read
                ;;
            12)
                clear
                banner
                sleep 3
                ;;
            13)
                clear
                echo -e "${YELLOW}Trafik izleme özelliği yakında eklenecek...${RESET}"
                sleep 3
                ;;
            14)
                clear
                otimizar
                echo -ne "\n${RED}ENTER tuşuna basarak ${YELLOW}tuşuna basarak ${GREEN}MENÜYE${RESET} dönün!"; read
                ;;
            15)
                clear
                userbackup
                echo -ne "\n${RED}ENTER tuşuna basarak ${YELLOW}tuşuna basarak ${GREEN}MENÜYE${RESET} dönün!"; read
                ;;
            16)
                [[ $(ps x | grep "limiter"|grep -v grep | wc -l) = '0' ]] && limit1 || limit2
                ;;
            17)
                [[ $(ps x | grep "udpvpn"|grep -v grep | wc -l) = '0' ]] && badvpn1 || badvpn2
                ;;
            18)
                clear
                detalhes
                echo -ne "\n${RED}ENTER tuşuna basarak ${YELLOW}tuşuna basarak ${GREEN}MENÜYE${RESET} dönün!"; read
                ;;
            19)
                menu2
                ;;
            0|00)
                echo -e "${RED}Çıkılıyor...${RESET}"
                sleep 2
                clear
                exit
                ;;
            *)
                echo -e "\n${RED}Geçersiz seçenek!${RESET}"
                sleep 2
                ;;
        esac
    done
}

# Menüyü başlat
menu
